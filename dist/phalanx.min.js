/*! Phalanx - v0.0.3 ( 2013-05-25 ) - MIT */
(function(t){"use strict";function e(t,e){var i;return"function"==typeof t?i=t:(e=t,i=e.hasOwnProperty("constructor")?e.constructor:function(){}),delete e.constructor,_.extend(i.prototype,e),i.extend=Backbone.View.extend,Object.defineProperty(i,"extend",r),i.with=n,Object.defineProperty(i,"with",r),i.create=o,Object.defineProperty(i,"create",r),i.prototype.super=s,i}function n(t,e){var n,o=0,s=Object.keys(t),i=s.length,r={};for(e||(e={});i>o;o++)n=s[o],e[n]?r[e[n]]=t[n]:r[n]=t[n];return this.prototype=_.extend(r,this.prototype),this}function o(){var t=Object.create(this.prototype);return this.apply(t,arguments),t}function s(t,e){return this.constructor.__super__[t].apply(this,e)}var i={},r={writable:!1};i.AsyncCallbacks={onSuccess:function(){},onFailure:function(){}},i.LifecycleCallbacks={onCreate:function(){},initialize:function(){},onDestroy:function(){}},i.Observable=Backbone.Events;var a='[data-ui="{name}"]';i.UiLookupable={ui:{},$ui:{},lookupUi:function(t){var e,n,o=t instanceof Backbone.$?t:Backbone.$(t),s=0,i=Object.keys(this.ui),r=i.length;for(this.ui={},this.$ui={};r>s;s++)e=i[s],n=a.replace("{name}",e),this.$ui[e]=o.find(n),this.ui[e]=this.$ui[e].length?this.$ui[e][0]:null},releaseUi:function(){for(var t,e=0,n=Object.keys(this.ui),o=n.length;o>e;e++)t=n[e],this.$ui[t]=null,this.ui[t]=null}};var c=e({constructor:function(t){t||(t={}),this.onCreate.apply(this,arguments),Backbone.Router.apply(this,arguments)}});c.with(i.LifecycleCallbacks),_.extend(c.prototype,Backbone.Router.prototype,{destroy:function(){this.onDestroy()}});var h=e({constructor:function(){this._processedListeners={},this._createdComponents={},this._processListeners(),this.onCreate.apply(this,arguments),Backbone.View.apply(this,arguments)}});h.with(i.UiLookupable).with(i.LifecycleCallbacks);var p="data-component",l="data-component-uid";_.extend(h.prototype,Backbone.View.prototype,{events:{},components:{},listeners:{},_createdComponents:{},_processedListeners:{},setElement:function(){Backbone.View.prototype.setElement.apply(this,arguments),this.el&&this.el.parentNode&&(this.lookupUi(this.$el),this.onSetElement(this.el))},delegateEvents:function(t){var e,n,o,s,i={},r=0,a=Object.keys(this.components),c=a.length;if(null==t){for(;c>r;r++)e=a[r],n=this.components[e].prototype,o=_.keys(n.events),s=_.map(n.events,this._getComponentEventClosure),_.extend(i,_.object(o,s));Backbone.View.prototype.delegateEvents.apply(this,[_.extend(i,this.events)])}else Backbone.View.prototype.delegateEvents.apply(this,arguments)},_getComponentEventClosure:function(t){return function(e){var n=this.getComponent(e.target);return n[t].apply(n,arguments)}},getComponent:function(t){var e,n;do e=t.getAttribute(p);while(!e&&(t=t.parentNode));if(!e)throw Error("Component name is not detected from `"+p+"`");return n=t.getAttribute(l),this._createdComponents[n]?this._createdComponents[n]:this._newComponent(e,t)},_newComponent:function(t,e){var n,o;return n=new this.components[t](e),o=n.uid,this._listenToComponent(n,t),e.setAttribute(l,o),this._createdComponents[o]=n,n},_listenToComponent:function(t,e){var n,o,s,i,r,a;if(n=this._processedListeners[e])for(o=0,s=Object.keys(n),i=s.length;i>o;o++){if(r=s[o],a=n[r],!_.isFunction(this[a]))throw Error("Method `"+a+"` is not exists this View");this.listenTo(t,r,this[a])}},_processListeners:function(){for(var t,e,n=0,o=Object.keys(this.listeners),s=o.length;s>n;n++)t=o[n].split(/\s+/),e=this.listeners[o[n]],(this._processedListeners[t[1]]={})[t[0]]=e},destroyComponents:function(){for(var t,e,n=0,o=Object.keys(this._createdComponents),s=o.length;s>n;n++)t=o[n],e=this._createdComponents[t],e.destroy(),this._createdComponents[t]=null,delete this._createdComponents[t]},destroy:function(){this.destroyRegions&&this.destroyRegions(),this.destroyComponents(),this.undelegateEvents(),this.stopListening(),this.releaseUi(),this.onDestroy(),this.el=this.$el=null},onSetElement:function(){},render:function(t){return this.$el.html(t),this}});var u=e({constructor:function(t,e){e||(e={}),this.onCreate.apply(this,arguments),Backbone.Model.apply(this,arguments)}});u.with(i.LifecycleCallbacks),_.extend(u.prototype,Backbone.Model.prototype,{syncParam:{},sync:function(t,e,n){return _.extend(n,this.syncParam),Backbone.Model.prototype.sync.apply(this,arguments)},destroy:function(){Backbone.Model.prototype.destroy.apply(this,arguments),this.onDestroy()}});var d=e({constructor:function(t,e){e||(e={}),this.onCreate.apply(this,arguments),Backbone.Collection.apply(this,arguments)}});d.with(i.LifecycleCallbacks),_.extend(d.prototype,Backbone.Collection.prototype,{syncParam:{},sync:function(t,e,n){return _.extend(n,this.syncParam),Backbone.Collection.prototype.sync.apply(this,arguments)},destroy:function(){this.reset(),this.onDestroy()}});var y=e({constructor:function(){this._assignedMap={},h.apply(this,arguments)}});_.extend(y.prototype,h.prototype,{events:{},regions:{},_assignedMap:{},assign:function(t,e){var n,o,s;if(n=this.regions[t],o=this.getRegionView(t),s=this.$el.find(n)[0],!n||!s)throw Error("Could not get element of `"+n+"` from the region "+t);this.onChange(t,e,o),o&&o.destroy(),e.setElement(s),this._assignedMap[t]=e},getRegionView:function(t){if(!(t in this.regions))throw Error("Specified region `"+t+"` is not declared");return this._assignedMap[t]},withdraw:function(t){var e=this.getRegionView(t);e.destroy(),this._assignedMap[t]=null},destroyRegions:function(){for(var t,e=0,n=Object.keys(this.regions),o=this.regions.length;o>e;e++)t=n[e],this.withdraw(t)},onChange:function(){}});var f=0,m=e({events:{},id:null,uid:null,constructor:function(t){this.uid=f++,this.onCreate.apply(this,arguments),this.setElement(t),this.initialize.apply(this,arguments)},setElement:function(t){this.$el=t instanceof Backbone.$?t:Backbone.$(t),this.el=this.$el[0],this.el&&this.el.parentNode&&(this.lookupUi(this.$el),this.onSetElement(this.el),this.id=parseInt(this.el.getAttribute("data-id"),10))},destroy:function(){this.releaseUi(),this.onDestroy(),this.el=this.$el=null},onSetElement:function(){}});m.with(i.Observable).with(i.UiLookupable).with(i.LifecycleCallbacks);var g={defineClass:e,Router:c,Model:u,Collection:d,View:h,Layout:y,Component:m,Trait:i};"function"==typeof define&&"object"==typeof define.amd&&define.amd?t.define(function(){return g}):"object"==typeof module&&module&&"object"==typeof exports&&exports&&module.exports===exports?module.exports=g:t.Phalanx=g})(this);
//@ sourceMappingURL=phalanx.map