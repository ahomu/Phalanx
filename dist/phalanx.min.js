/*! Phalanx - v0.0.3 ( 2013-05-19 ) - MIT */
(function(e){"use strict";function t(e,t){var s;return"function"==typeof e?s=e:(t=e,s=t.hasOwnProperty("constructor")?t.constructor:function(){}),delete t.constructor,_.extend(s.prototype,t),s.extend=Backbone.View.extend,Object.defineProperty(s,"extend",r),s.with=n,Object.defineProperty(s,"with",r),s.create=o,Object.defineProperty(s,"create",r),s.prototype.super=i,s}function n(e,t){var n,o=0,i=Object.keys(e),s=i.length,r={};for(t||(t={});s>o;o++)n=i[o],t[n]?r[t[n]]=e[n]:r[n]=e[n];return _.extend(this.prototype,r),this}function o(){var e=Object.create(this.prototype);return this.apply(e,arguments),e}function i(e,t){return this.constructor.__super__[e].apply(this,t)}var s={},r={writable:!1};s.AsyncCallbacks={onSuccess:function(){},onFailure:function(){}},s.LifecycleCallbacks={onCreate:function(){},initialize:function(){},onDestroy:function(){}},s.Observable=Backbone.Events;var a='[data-ui="{name}"]';s.UiLookupable={ui:{},$ui:{},lookupUi:function(e){var t,n,o=e instanceof Backbone.$?e:Backbone.$(e),i=0,s=Object.keys(this.ui),r=s.length;for(this.ui={},this.$ui={};r>i;i++)t=s[i],n=a.replace("{name}",t),this.$ui[t]=o.find(n),this.ui[t]=this.$ui[t][0]},releaseUi:function(){for(var e,t=0,n=Object.keys(this.ui),o=n.length;o>t;t++)e=n[t],this.$ui[e]=null,this.ui[e]=null}};var c=t({constructor:function(e){e||(e={}),this.onCreate.apply(this,arguments),Backbone.Router.apply(this,arguments)}});c.with(s.LifecycleCallbacks),_.extend(c.prototype,Backbone.Router.prototype,{destroy:function(){this.onDestroy()}});var l=t({constructor:function(){this._createdComponents={},this.onCreate.apply(this,arguments),Backbone.View.apply(this,arguments)}});l.with(s.UiLookupable).with(s.LifecycleCallbacks);var p="data-component",h="data-component-uid";_.extend(l.prototype,Backbone.View.prototype,{events:{},components:{},_createdComponents:{},setElement:function(){Backbone.View.prototype.setElement.apply(this,arguments),this.el&&this.el.parentNode&&(this.lookupUi(this.el),this.onSetElement(this.el))},delegateEvents:function(e){var t,n,o,i,s={},r=0,a=Object.keys(this.components),c=a.length;if(null==e){for(;c>r;r++)t=a[r],n=this.components[t].prototype,o=_.keys(n.events),i=_.map(n.events,this._getComponentEventClosure),_.extend(s,_.object(o,i));Backbone.View.prototype.delegateEvents.apply(this,[_.extend(s,this.events)])}else Backbone.View.prototype.delegateEvents.apply(this,arguments)},_getComponentEventClosure:function(e){return function(t){var n=this.getComponent(t.target);n[e].apply(n,arguments)}},getComponent:function(e){var t,n,o;do t=e.getAttribute(p);while(!t&&(e=e.parentNode));if(!t)throw Error("Component name is not detected from "+p);return o=e.getAttribute(h),o&&this._createdComponents[o]?this._createdComponents[o]:(n=new this.components[t](e),o=n.uid,e.setAttribute(h,o),this._createdComponents[o]=n,n)},destroyComponents:function(){for(var e,t,n=0,o=Object.keys(this._createdComponents),i=o.length;i>n;n++)e=o[n],t=this._createdComponents[e],t.destroy(),this._createdComponents[e]=null,delete this._createdComponents[e]},destroy:function(){this.destroyComponents(),this.undelegateEvents(),this.releaseUi(),this.onDestroy(),this.el=this.$el=null},onSetElement:function(){},render:function(e){return this.$el.html(e),this}});var u=t({constructor:function(e,t){t||(t={}),this.onCreate.apply(this,arguments),Backbone.Model.apply(this,arguments)}});u.with(s.LifecycleCallbacks),_.extend(u.prototype,Backbone.Model.prototype,{destroy:function(){Backbone.Model.prototype.destroy.apply(this,arguments),this.onDestroy()}});var d=t({constructor:function(e,t){t||(t={}),this.onCreate.apply(this,arguments),Backbone.Collection.apply(this,arguments)}});d.with(s.LifecycleCallbacks),_.extend(d.prototype,Backbone.Collection.prototype,{destroy:function(){this.reset(),this.onDestroy()}});var y=t({constructor:function(){this._assignedMap={},this.onCreate.apply(this,arguments),Backbone.View.apply(this,arguments)}});y.with(s.LifecycleCallbacks),_.extend(y.prototype,Backbone.View.prototype,{events:{},regions:{},_assignedMap:{},setElement:function(){Backbone.View.prototype.setElement.apply(this,arguments),this.el&&this.el.parentNode&&this.onSetElement(this.el)},assign:function(e,t){var n,o,i;if(n=this.regions[e],o=this.getRegionView(e),i=this.$el.find(n)[0],!n||!i)throw Error("Could not get element of `"+n+"` from the region "+e);this.onChange(e,t,o),o&&o.destroy(),t.lookupUi&&t.lookupUi(i),t.setElement(i),this._assignedMap[e]=t},getRegionView:function(e){if(!(e in this.regions))throw Error("Specified region `"+e+"` is not declared");return this._assignedMap[e]},withdraw:function(e){var t;return t=this.getRegionView(e),t.destroy(),this._assignedMap[e]=null,t},destroyRegions:function(){for(var e,t=0,n=Object.keys(this.regions),o=this.regions.length;o>t;t++)e=n[t],this.withdraw(e)},destroy:function(){this.destroyRegions(),this.undelegateEvents(),this.onDestroy(),this.el=this.$el=null},onSetElement:function(){},onChange:function(){}});var f=0,m=t({events:{},uid:null,constructor:function(e){this.uid=f++,this.onCreate.apply(this,arguments),this.setElement(e),this.initialize.apply(this,arguments)},setElement:function(e){this.$el=e instanceof Backbone.$?e:Backbone.$(e),this.el=this.$el[0],this.el&&this.el.parentNode&&(this.lookupUi(this.el),this.onSetElement(this.el))},destroy:function(){this.releaseUi(),this.onDestroy(),this.el=this.$el=null},onSetElement:function(){}});m.with(s.Observable).with(s.UiLookupable).with(s.LifecycleCallbacks);var g={defineClass:t,Router:c,Model:u,Collection:d,View:l,Layout:y,Component:m,Trait:s};"function"==typeof define&&"object"==typeof define.amd&&define.amd?e.define(function(){return g}):"object"==typeof module&&module&&"object"==typeof exports&&exports&&module.exports===exports?module.exports=g:e.Phalanx=g})(this);
//@ sourceMappingURL=phalanx.map