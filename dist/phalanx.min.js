/*! Phalanx - v0.0.0 ( 2013-05-11 ) - MIT */
(function(t){"use strict";function e(t,e){var r;return"function"==typeof t?r=t:(e=t,r=e.hasOwnProperty("constructor")?e.constructor:function(){}),delete e.constructor,_.extend(r.prototype,e),r.extend=Backbone.View.extend,Object.defineProperty(r,"extend",s),r.with=n,Object.defineProperty(r,"with",s),r.create=o,Object.defineProperty(r,"create",s),r.prototype.super=i,r}function n(t,e){var n,o=0,i=Object.keys(t),s=i.length,r={};for(e||(e={});s>o;o++)n=i[o],e[n]?r[e[n]]=t[n]:r[n]=t[n];return _.extend(this.prototype,r),this}function o(){var t=Object.create(this.prototype);return this.apply(t,arguments),t}function i(t,e){return this.__super__[t].apply(this,e)}var s={writable:!1},r=e({constructor:function(t){t||(t={}),this.onCreate.apply(this,arguments),Backbone.View.apply(this,arguments)}}),u=Backbone.View.prototype,a="data-component",l="data-component-uid";_.extend(r.prototype,u,{events:{},ui:{},components:{},_createdComponents:{},setElement:function(t){this.onSetElement(t),u.setElement.apply(this,arguments),this.lookupUi()},delegateEvents:function(t){var e,n,o,i,s={},r=0,a=Object.keys(this.components),l=a.length;if(null==t){for(;l>r;r++)e=a[r],n=this.components[e].prototype,o=_.keys(n.events),i=_.map(n.events,this._getComponentEventClosure),_.extend(s,_.object(o,i));u.delegateEvents.apply(this,[_.extend(s,this.events)])}else u.delegateEvents.apply(this,arguments)},_getComponentEventClosure:function(t){return function(e){var n=this.getComponent(e.target);n[t].apply(n,arguments)}},getComponent:function(t){var e,n,o;do e=t.getAttribute(a);while(!e&&(t=t.parentNode));if(!e)throw Error("Component name is not detected from "+a);return o=t.getAttribute(l),o&&this._createdComponents[o]?this._createdComponents[o]:(n=new this.components[e](t),o=n.uid,t.setAttribute(l,o),this._createdComponents[o]=n,n)},lookupUi:function(){for(var t,e,n={},o=0,i=Object.keys(this.ui),s=i.length;s>o;o++)t=i[o],e=this.ui[t],n[t]=this.$el.find(e);this.ui=n},releaseUi:function(){for(var t,e=0,n=Object.keys(this.ui),o=n.length;o>e;e++)t=n[e],this.ui[t]=null,delete this.ui[t]},destroyComponents:function(){for(var t,e,n=0,o=Object.keys(this._createdComponents),i=o.length;i>n;n++)t=o[n],e=this._createdComponents[t],e.destroy(),this._createdComponents[t]=null,delete this._createdComponents[t]},destroy:function(){this.undelegateEvents(),this.destroyComponents(),this.releaseUi(),this.onDestroy()},initialize:function(){},render:function(t){return this.$el.html(t),this},onCreate:function(){},onSetElement:function(){},onDestroy:function(){}});var c=e({constructor:function(t,e){e||(e={}),this.onCreate.apply(this,arguments),Backbone.Model.apply(this,arguments)}});_.extend(c.prototype,Backbone.Model.prototype,{initialize:function(){},onCreate:function(){},onDestroy:function(){}});var h=e({constructor:function(t,e){e||(e={}),this.onCreate.apply(this,arguments),Backbone.Collection.apply(this,arguments)}});_.extend(h.prototype,Backbone.Collection.prototype,{initialize:function(){},onCreate:function(){},onDestroy:function(){}});var p=e({el:null,$el:null,regions:{},_assignedMap:{},constructor:function(t){t||(t={}),t.el&&(this.el=t.el),t.regions&&_.extend(this.regions,t.regions),_.isElement(this.el)?this.setElement(this.el):this.setElement(document.body),this.onCreate.apply(this,arguments),this.initialize.apply(this,arguments)},setElement:function(t){this.$el=t instanceof Backbone.$?t:Backbone.$(t),this.el=this.$el[0]},assign:function(t,e){var n,o;if(n=this.regions[t],o=this.getRegionView(t),!n)throw Error("Could not get a selector from the region "+t);this.onChange(t,e,o),o&&o.destroy(),e.setElement(this.$el.find(n)[0]),this._assignedMap[t]=e},getRegionView:function(t){if(!(t in this.regions))throw Error("Undefined region `"+t+"` is specified");return this._assignedMap[t]||null},withdraw:function(t){var e;return e=this.getRegionView(t),e.destroy(),this._assignedMap[t]=null,e},destroy:function(){this.onDestroy();for(var t,e=0,n=Object.keys(this.regions),o=this.regions.length;o>e;e++)t=n[e],this.withdraw(t)},onChange:function(){},initialize:function(){},onCreate:function(){},onDestroy:function(){}}),f=0,d=e({el:null,$el:null,events:{},ui:{},uid:null,constructor:function(t){this.$el=t instanceof Backbone.$?t:Backbone.$(t),this.el=this.$el[0],this.uid=f++,this.lookupUi(),this.onCreate.apply(this,arguments),this.initialize.apply(this,arguments)},destroy:function(){this.el=this.$el=null,this.releaseUi(),this.onDestroy()},lookupUi:function(){for(var t,e,n={},o=0,i=Object.keys(this.ui),s=i.length;s>o;o++)t=i[o],e=this.ui[t],n[t]=this.$el.find(e);this.ui=n},releaseUi:function(){for(var t,e=0,n=Object.keys(this.ui),o=n.length;o>e;e++)t=n[e],this.ui[t]=null,delete this.ui[t]},initialize:function(){},onCreate:function(){},onDestroy:function(){}}),y={defineClass:e,Model:c,Collection:h,View:r,Layout:p,Component:d};"function"==typeof define&&"object"==typeof define.amd&&define.amd?t.define(function(){return y}):"object"==typeof module&&module&&"object"==typeof exports&&exports&&module.exports===exports?module.exports=y:t.Phalanx=y})(this);